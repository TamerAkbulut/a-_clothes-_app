<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI KÄ±yafet AsistanÄ± | Agentic AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="pictures\logo.jpg">
   <style>
        :root {
            --bg-blur: rgba(255, 255, 255, 0.75);
            --accent: #00d2ff;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: url('https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=1920&q=80') center/cover fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .app-window {
            width: 95%;
            max-width: 1200px;
            background: var(--bg-blur);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 40px 100px var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.4);
            overflow: hidden;
            animation: fadeIn 1s ease-out;
        }

        header {
            background: #1a1a1a;
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 { font-size: 22px; font-weight: 500; margin: 0; letter-spacing: -0.5px; }
        .agent-label { font-size: 14px; color: #aaa; font-weight: 400; }

        .search-bar {
            padding: 20px 40px;
            background: rgba(255, 255, 255, 0.5);
            display: flex;
            gap: 15px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        input {
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid #ddd;
            background: white;
            font-size: 15px;
            outline: none;
        }

        button {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: 500;
        }

        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 280px 1fr 1fr 1fr;
            gap: 25px;
            padding: 40px;
        }

        .weather-panel {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.02);
        }

        .weather-panel h3 { font-size: 14px; color: #888; text-transform: uppercase; margin-top: 0; }
        .main-temp { font-size: 48px; font-weight: 600; color: #1a1a1a; margin: 20px 0; }
        .weather-meta { font-size: 14px; color: #555; line-height: 2.2; }

        .outfit-card {
            background: white;
            padding: 30px 20px;
            border-radius: 20px;
            text-align: center;
            transition: 0.4s;
            border: 1px solid transparent;
            cursor: pointer;
            position: relative;
        }

        .outfit-card:hover { 
            transform: translateY(-10px); 
            border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(0,0,0,0.05);
        }

        .outfit-card::after {
            content: 'ğŸ” DetaylarÄ± GÃ¶r';
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--accent);
            opacity: 0;
            transition: 0.3s;
        }

        .outfit-card:hover::after { opacity: 1; }

        .card-title { font-size: 15px; font-weight: 500; color: #999; margin-bottom: 25px; }

        .visual-container {
            height: 180px;
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .visual-container img {
            max-height: 100%;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
        }

        .outfit-info { font-size: 13px; color: #444; line-height: 1.6; }
        .outfit-info b { display: block; margin-bottom: 5px; color: #1a1a1a; font-size: 14px; }

        /* Detay Paneli */
        .detail-panel {
            position: fixed;
            right: -600px;
            top: 0;
            width: 550px;
            height: 100vh;
            background: white;
            box-shadow: -10px 0 50px rgba(0,0,0,0.2);
            transition: right 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow-y: auto;
        }

        .detail-panel.active { right: 0; }

        .detail-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .detail-header h2 { margin: 0 0 10px 0; font-size: 24px; font-weight: 600; }
        .detail-header p { margin: 0; opacity: 0.9; font-size: 14px; }

        .close-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: 0.3s;
        }

        .close-btn:hover { background: rgba(255,255,255,0.3); transform: rotate(90deg); }

        .detail-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee;
        }

        .section:last-child { border-bottom: none; }

        .section h3 {
            font-size: 16px;
            color: #667eea;
            margin: 0 0 15px 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section p {
            line-height: 1.8;
            color: #444;
            margin: 0;
        }

        .alternative-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 3px solid var(--accent);
            opacity: 0;
            animation: slideIn 0.5s ease forwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alternative-item h4 {
            margin: 0 0 10px 0;
            color: #1a1a1a;
            font-size: 15px;
            font-weight: 600;
        }

        .alternative-item p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }

        .ai-status-float {
            position: fixed;
            bottom: 40px;
            right: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            z-index: 999;
        }

        .orb {
            width: 90px;
            height: 90px;
            background: radial-gradient(circle at 30% 30%, #4facfe, #00f2fe);
            border-radius: 50%;
            box-shadow: 0 0 40px rgba(0, 210, 255, 0.5);
            animation: pulseOrb 4s infinite alternate;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .banana-float {
            font-size: 35px;
            filter: drop-shadow(0 0 10px rgba(255,255,0,0.5));
            animation: floatBanana 3s ease-in-out infinite;
        }

        #loading-overlay {
            display: none;
            text-align: center;
            padding: 10px;
            color: var(--accent);
            font-weight: 500;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
            z-index: 999;
        }

        .overlay.active { opacity: 1; pointer-events: all; }

        @keyframes pulseOrb {
            from { transform: scale(1); box-shadow: 0 0 30px rgba(0, 210, 255, 0.4); }
            to { transform: scale(1.1); box-shadow: 0 0 60px rgba(0, 210, 255, 0.7); }
        }

        @keyframes floatBanana {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(10deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div class="app-window">
        <header>
            <h1>AI KÄ±yafet AsistanÄ±</h1>
            <div class="agent-label">Agentic AI | <span id="agent-state">HazÄ±r</span></div>
        </header>

        <div class="search-bar">
            <input type="text" id="cityInput" placeholder="Bir ÅŸehir girin (Ã¶rn: Ä°stanbul)">
            <button onclick="runAgent()">Analiz Et</button>
        </div>

        <div id="loading-overlay">Agent kararlar alÄ±yor...</div>

        <div class="dashboard-grid">
            <div class="weather-panel">
                <h3 id="loc-name">Hava Durumu</h3>
                <div class="main-temp" id="temp-display">--Â°C</div>
                <div class="weather-meta">
                    Åehir: <span id="m_city">-</span><br>
                    Nem: <span id="m_hum">-</span><br>
                    RÃ¼zgar: <span id="m_wind">-</span><br>
                    Durum: <span id="m_desc">-</span>
                </div>
            </div>

            <div class="outfit-card" onclick="showDetail('morning')">
                <div class="card-title">Sabah</div>
                <div class="visual-container">
                    <img id="img_morning" src="pictures\pijama.png">
                </div>
                <div class="outfit-info" id="text_morning">Hava verisi bekleniyor...</div>
            </div>

            <div class="outfit-card" onclick="showDetail('afternoon')">
                <div class="card-title">Ã–ÄŸlen</div>
                <div class="visual-container">
                    <img id="img_afternoon" src="pictures\casual_wear.jpg">
                </div>
                <div class="outfit-info" id="text_afternoon">Veriler analiz edilecek...</div>
            </div>

            <div class="outfit-card" onclick="showDetail('evening')">
                <div class="card-title">AkÅŸam</div>
                <div class="visual-container">
                    <img id="img_evening" src="pictures\takÄ±m.png">
                </div>
                <div class="outfit-info" id="text_evening">HazÄ±rlanÄ±yor...</div>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeDetail()"></div>

    <div class="detail-panel" id="detailPanel">
        <div class="detail-header">
            <button class="close-btn" onclick="closeDetail()">âœ•</button>
            <h2 id="detail-title">Sabah KÄ±yafet Ã–nerisi</h2>
            <p id="detail-subtitle">AI tarafÄ±ndan Ã¶zelleÅŸtirilmiÅŸ Ã¶neri</p>
        </div>
        <div class="detail-content">
            <div class="section">
                <h3>ğŸ“‹ DetaylÄ± Analiz</h3>
                <p id="detail-analysis">YÃ¼kleniyor...</p>
            </div>
            <div class="section">
                <h3>ğŸ’¡ Neden Bu Ã–neri?</h3>
                <p id="detail-reason">YÃ¼kleniyor...</p>
            </div>
            <div class="section">
                <h3>ğŸ¨ Alternatif Ã–neriler</h3>
                <div id="alternatives-container"></div>
            </div>
        </div>
    </div>

    <div class="ai-status-float">
        <div class="banana-float">ğŸŒ</div>
        <div class="orb">GEMINI</div>
    </div>

    <script>
        let currentData = {};

        async function runAgent() {
            const city = document.getElementById('cityInput').value || 'Ä°stanbul';
            const state = document.getElementById('agent-state');
            const overlay = document.getElementById('loading-overlay');

            state.textContent = "Analiz YapÄ±lÄ±yor...";
            overlay.style.display = "block";

            try {
                console.log('ğŸ™ï¸ Åehir aranÄ±yor:', city);
                
                // 1. Åehir koordinatlarÄ±nÄ± al
                const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=tr&format=json`);
                const geoData = await geo.json();
                
                if (!geoData.results || geoData.results.length === 0) {
                    throw new Error('Åehir bulunamadÄ±! LÃ¼tfen geÃ§erli bir ÅŸehir adÄ± girin.');
                }
                
                const loc = geoData.results[0];
                console.log('ğŸ“ Konum bulundu:', loc.name);

                // 2. Hava durumu al
                const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.latitude}&longitude=${loc.longitude}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=auto`);
                const wData = await w.json();
                console.log('ğŸŒ¡ï¸ Hava durumu alÄ±ndÄ±:', wData.current);

                // UI GÃ¼ncelleme
                document.getElementById('m_city').textContent = loc.name;
                document.getElementById('temp-display').textContent = `${Math.round(wData.current.temperature_2m)}Â°C`;
                document.getElementById('m_hum').textContent = `%${wData.current.relative_humidity_2m}`;
                document.getElementById('m_wind').textContent = `${wData.current.wind_speed_10m} km/h`;
                document.getElementById('m_desc').textContent = "Bulutlu";

                // 3. AI API Ã§aÄŸrÄ±sÄ±
                console.log('ğŸ”„ AI API Ã§aÄŸrÄ±sÄ± yapÄ±lÄ±yor...');
                const apiUrl = `http://localhost:8000/api/ai?temp=${wData.current.temperature_2m}&description=Bulutlu&wind=${wData.current.wind_speed_10m}&location=${encodeURIComponent(loc.name)}`;
                console.log('ğŸ“¡ API URL:', apiUrl);
                
                const aiRes = await fetch(apiUrl);
                console.log('ğŸ“¥ API Response Status:', aiRes.status, aiRes.statusText);
                
                if (!aiRes.ok) {
                    const errorText = await aiRes.text();
                    console.error('âŒ API HatasÄ±:', errorText);
                    throw new Error(`API HatasÄ±: ${aiRes.status} - ${aiRes.statusText}`);
                }
                
                const aiData = await aiRes.json();
                console.log('âœ… AI YanÄ±tÄ± AlÄ±ndÄ±:', aiData);

                // Veri kontrolÃ¼
                if (!aiData || typeof aiData !== 'object') {
                    throw new Error('GeÃ§ersiz AI yanÄ±tÄ±');
                }

                // Global deÄŸiÅŸkene kaydet
                currentData = aiData;
                console.log('ğŸ’¾ currentData gÃ¼ncellendi:', currentData);
                console.log('ğŸ”‘ currentData keys:', Object.keys(currentData));

                // Her period iÃ§in gÃ¼venli veri gÃ¶sterimi
                const periods = ['morning', 'afternoon', 'evening'];
                let successCount = 0;
                
                periods.forEach(period => {
                    const data = aiData[period];
                    if (data && data.short) {
                        document.getElementById(`text_${period}`).innerHTML = `<b>${data.short}</b>`;
                        console.log(`âœ… ${period} verisi gÃ¼ncellendi:`, data.short);
                        successCount++;
                    } else {
                        document.getElementById(`text_${period}`).innerHTML = '<b>âš ï¸ Veri eksik</b>';
                        console.warn(`âš ï¸ ${period} verisi eksik:`, data);
                    }
                });

                state.textContent = "Aktif âœ“";
                
                if (successCount === 3) {
                    alert('âœ… Analizler hazÄ±r! Kartlara tÄ±klayarak detaylarÄ± gÃ¶rebilirsiniz.');
                } else {
                    alert(`âš ï¸ ${successCount}/3 zaman dilimi yÃ¼klendi. Eksik veriler iÃ§in fallback kullanÄ±ldÄ±.`);
                }

            } catch (err) {
                state.textContent = "Hata!";
                console.error('âŒ Hata detayÄ±:', err);
                alert(`âŒ Hata: ${err.message}\n\nLÃ¼tfen:\n1. Python server'Ä±n Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun\n2. Konsolu (F12) kontrol edin\n3. Åehir adÄ±nÄ± doÄŸru yazdÄ±ÄŸÄ±nÄ±zdan emin olun`);
            } finally {
                overlay.style.display = "none";
            }
        }

        function showDetail(period) {
            console.log(`ğŸ” showDetail Ã§aÄŸrÄ±ldÄ±: ${period}`);
            console.log('ğŸ“¦ currentData:', currentData);
            
            if (!currentData || Object.keys(currentData).length === 0) {
                alert('âŒ Veri yok! LÃ¼tfen Ã¶nce "Analiz Et" butonuna basÄ±n.');
                return;
            }

            if (!currentData[period]) {
                alert(`âŒ ${period} iÃ§in veri bulunamadÄ±!`);
                console.error(`Eksik period: ${period}`, currentData);
                return;
            }

            const titles = {
                morning: 'ğŸŒ… Sabah KÄ±yafet Ã–nerisi',
                afternoon: 'â˜€ï¸ Ã–ÄŸlen KÄ±yafet Ã–nerisi',
                evening: 'ğŸŒ™ AkÅŸam KÄ±yafet Ã–nerisi'
            };

            const data = currentData[period];
            console.log(`ğŸ“‹ ${period} verisi:`, data);

            // UI'Ä± gÃ¼ncelle
            document.getElementById('detail-title').textContent = titles[period];
            document.getElementById('detail-subtitle').textContent = data.short || 'AI Ã–nerisi';
            document.getElementById('detail-analysis').textContent = data.detail || 'ğŸ“ DetaylÄ± analiz yÃ¼kleniyor...';
            document.getElementById('detail-reason').textContent = data.reason || 'ğŸ’¡ GerekÃ§e hazÄ±rlanÄ±yor...';

            // Alternatifleri gÃ¶ster
            const alts = data.alternatives || [];
            const container = document.getElementById('alternatives-container');
            container.innerHTML = '';

            console.log(`ğŸ¨ ${alts.length} alternatif bulundu`);

            if (alts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #999;">
                        <p style="font-size: 16px;">ğŸ”„ Alternatif Ã¶neriler hazÄ±rlanÄ±yor...</p>
                        <p style="font-size: 14px;">Gemini AI Ã¶nerileri oluÅŸturuyor</p>
                    </div>
                `;
            } else {
                alts.forEach((alt, index) => {
                    const div = document.createElement('div');
                    div.className = 'alternative-item';
                    div.style.animationDelay = `${index * 0.1}s`;
                    div.innerHTML = `
                        <h4>âœ¨ ${alt.title || `Alternatif ${index + 1}`}</h4>
                        <p>${alt.description || 'AÃ§Ä±klama yÃ¼kleniyor...'}</p>
                    `;
                    container.appendChild(div);
                });
            }

            // Paneli aÃ§
            document.getElementById('detailPanel').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            console.log('âœ… Detay paneli aÃ§Ä±ldÄ±');
        }

        function closeDetail() {
            document.getElementById('detailPanel').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
    </script>
</body>
</html>